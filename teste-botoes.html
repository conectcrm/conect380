<!DOCTYPE html>
<html>

<head>
  <title>Teste Bot√µes Email e WhatsApp</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ccc;
    }

    .button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }

    .success {
      background: #d4edda;
      color: #155724;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
    }
  </style>
</head>

<body>
  <h1>üîß Teste de Corre√ß√£o dos Bot√µes</h1>

  <div class="test-section">
    <h2>1. Teste Manual de For√ßa</h2>
    <button class="button" onclick="forcarHabilitacao()">For√ßar Habilita√ß√£o dos Bot√µes</button>
    <div id="resultado-forca"></div>
  </div>

  <div class="test-section">
    <h2>2. Diagn√≥stico Completo</h2>
    <button class="button" onclick="diagnosticoCompleto()">Executar Diagn√≥stico</button>
    <div id="resultado-diagnostico"></div>
  </div>

  <div class="test-section">
    <h2>3. Limpar Cache e Recarregar</h2>
    <button class="button" onclick="limparCache()">Limpar Cache + Reload</button>
  </div>

  <script>
    function forcarHabilitacao() {
      const resultado = document.getElementById('resultado-forca');

      // Abrir a p√°gina de propostas em nova aba
      const propostasWindow = window.open('http://localhost:3901', '_blank');

      setTimeout(() => {
        try {
          // Script para executar na p√°gina de propostas
          const script = `
                        // For√ßar habilita√ß√£o de todos os bot√µes disabled
                        const botoes = document.querySelectorAll('button[disabled]');
                        let count = 0;
                        
                        botoes.forEach(btn => {
                            if (btn.title && (btn.title.includes('email') || btn.title.includes('WhatsApp'))) {
                                btn.disabled = false;
                                btn.className = btn.className.replace(/opacity-50|cursor-not-allowed/g, '');
                                count++;
                            }
                        });
                        
                        console.log('‚úÖ Bot√µes habilitados:', count);
                        alert('Bot√µes habilitados: ' + count);
                    `;

          // Executar o script na nova aba
          propostasWindow.eval(script);

          resultado.className = 'success';
          resultado.innerHTML = '‚úÖ Script executado! Verifique a p√°gina de propostas.';
        } catch (error) {
          resultado.className = 'error';
          resultado.innerHTML = '‚ùå Erro: ' + error.message;
        }
      }, 3000);
    }

    function diagnosticoCompleto() {
      const resultado = document.getElementById('resultado-diagnostico');

      // Diagnosticar problemas comuns
      const diagnosticos = [];

      // Verificar se a porta est√° correta
      fetch('http://localhost:3901')
        .then(response => {
          if (response.ok) {
            diagnosticos.push('‚úÖ Frontend acess√≠vel na porta 3901');
          } else {
            diagnosticos.push('‚ùå Problema de acesso ao frontend');
          }
        })
        .catch(() => {
          diagnosticos.push('‚ùå Frontend n√£o est√° rodando ou inacess√≠vel');
        })
        .finally(() => {
          // Verificar localStorage
          const keys = Object.keys(localStorage);
          if (keys.length > 0) {
            diagnosticos.push('‚ö†Ô∏è Cache do localStorage presente: ' + keys.length + ' chaves');
          } else {
            diagnosticos.push('‚úÖ localStorage limpo');
          }

          // Mostrar resultados
          resultado.innerHTML = '<pre>' + diagnosticos.join('\\n') + '</pre>';
        });
    }

    function limparCache() {
      // Limpar todos os dados do navegador para o dom√≠nio
      localStorage.clear();
      sessionStorage.clear();

      // Tentar limpar cache
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => {
            caches.delete(name);
          });
        });
      }

      alert('Cache limpo! Redirecionando...');

      // Redirecionar com cache bust
      const timestamp = new Date().getTime();
      window.location.href = `http://localhost:3901?v=${timestamp}`;
    }
  </script>
</body>

</html>