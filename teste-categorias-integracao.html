<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Categorias - FenixCRM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #159A9C;
        }
        .btn {
            background: #159A9C;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0F7B7D;
        }
        #resultado {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        .input-group {
            margin: 10px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Integra√ß√£o - Categorias</h1>
        <p>Este teste verifica se as categorias cadastradas aparecem no modal de produtos.</p>

        <div class="section">
            <h3>1. Gerenciar Categorias localStorage</h3>
            <button class="btn" onclick="adicionarCategoriasTeste()">Adicionar Categorias de Teste</button>
            <button class="btn" onclick="listarCategorias()">Listar Categorias</button>
            <button class="btn" onclick="limparCategorias()">Limpar Categorias</button>
            
            <div class="input-group">
                <label>Nova Categoria:</label>
                <input type="text" id="nomeCategoria" placeholder="Nome da categoria">
                <textarea id="descricaoCategoria" placeholder="Descri√ß√£o (opcional)" rows="2"></textarea>
                <button class="btn" onclick="criarCategoria()">Criar Categoria</button>
            </div>
        </div>

        <div class="section">
            <h3>2. Simular Carregamento do Modal</h3>
            <p>Este teste simula como o modal de produto carregaria as categorias.</p>
            <button class="btn" onclick="simularModalCarregamento()">Simular Carregamento Modal</button>
        </div>

        <div class="section">
            <h3>3. Instru√ß√µes de Teste</h3>
            <ol>
                <li>Clique em "Adicionar Categorias de Teste" para criar algumas categorias</li>
                <li>Abra o sistema em <a href="http://localhost:3900" target="_blank">http://localhost:3900</a></li>
                <li>V√° para Produtos ‚Üí Novo Produto</li>
                <li>Verifique se as categorias aparecem no dropdown "Categoria"</li>
                <li>Teste cadastrar uma nova categoria aqui e verificar se aparece l√°</li>
            </ol>
        </div>

        <div id="resultado"></div>
    </div>

    <script>
        const STORAGE_KEY = 'fenixcrm_categorias';
        const resultado = document.getElementById('resultado');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : (type === 'success' ? 'success' : '');
            resultado.innerHTML = `[${timestamp}] ${message}\n` + resultado.innerHTML;
            if (className) {
                resultado.className = className;
            }
        }

        function adicionarCategoriasTeste() {
            const categoriasTeste = [
                {
                    id: 'cat_1',
                    nome: 'Software Empresarial',
                    descricao: 'Solu√ß√µes de software para empresas',
                    icone: 'üíª',
                    cor: 'blue',
                    ativo: true,
                    subcategorias: [],
                    criadoEm: new Date().toISOString(),
                    atualizadoEm: new Date().toISOString()
                },
                {
                    id: 'cat_2', 
                    nome: 'Consultoria T√©cnica',
                    descricao: 'Servi√ßos de consultoria especializada',
                    icone: 'üéØ',
                    cor: 'green',
                    ativo: true,
                    subcategorias: [],
                    criadoEm: new Date().toISOString(),
                    atualizadoEm: new Date().toISOString()
                },
                {
                    id: 'cat_3',
                    nome: 'Treinamento & Capacita√ß√£o',
                    descricao: 'Cursos e treinamentos especializados',
                    icone: 'üìö',
                    cor: 'orange',
                    ativo: true,
                    subcategorias: [],
                    criadoEm: new Date().toISOString(),
                    atualizadoEm: new Date().toISOString()
                }
            ];

            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(categoriasTeste));
                log('‚úÖ Categorias de teste adicionadas com sucesso!', 'success');
                log(`Criadas: ${categoriasTeste.map(c => c.nome).join(', ')}`);
            } catch (error) {
                log('‚ùå Erro ao adicionar categorias: ' + error.message, 'error');
            }
        }

        function listarCategorias() {
            try {
                const categorias = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                if (categorias.length === 0) {
                    log('üì≠ Nenhuma categoria encontrada no localStorage');
                } else {
                    log(`üìã ${categorias.length} categoria(s) encontrada(s):`);
                    categorias.forEach(cat => {
                        log(`  ‚Ä¢ ${cat.nome} (${cat.id}) - ${cat.descricao}`);
                    });
                }
            } catch (error) {
                log('‚ùå Erro ao listar categorias: ' + error.message, 'error');
            }
        }

        function limparCategorias() {
            try {
                localStorage.removeItem(STORAGE_KEY);
                log('üóëÔ∏è Categorias removidas do localStorage', 'success');
            } catch (error) {
                log('‚ùå Erro ao limpar categorias: ' + error.message, 'error');
            }
        }

        function criarCategoria() {
            const nome = document.getElementById('nomeCategoria').value.trim();
            const descricao = document.getElementById('descricaoCategoria').value.trim();

            if (!nome) {
                log('‚ùå Nome da categoria √© obrigat√≥rio', 'error');
                return;
            }

            try {
                const categorias = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                
                const novaCategoria = {
                    id: 'cat_' + Date.now(),
                    nome: nome,
                    descricao: descricao || `Categoria ${nome}`,
                    icone: 'üìÅ',
                    cor: 'blue',
                    ativo: true,
                    subcategorias: [],
                    criadoEm: new Date().toISOString(),
                    atualizadoEm: new Date().toISOString()
                };

                categorias.push(novaCategoria);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(categorias));

                log(`‚úÖ Categoria "${nome}" criada com sucesso!`, 'success');
                document.getElementById('nomeCategoria').value = '';
                document.getElementById('descricaoCategoria').value = '';
                
            } catch (error) {
                log('‚ùå Erro ao criar categoria: ' + error.message, 'error');
            }
        }

        function simularModalCarregamento() {
            log('üîÑ Simulando carregamento das categorias pelo modal...');
            
            try {
                // Simula o mesmo processo que o modal faria
                const categorias = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                
                if (categorias.length === 0) {
                    log('‚ö†Ô∏è Nenhuma categoria encontrada - modal usaria categorias padr√£o');
                    const categoriasPadrao = [
                        'Software', 'Hardware', 'Consultoria', 'Marketing', 'Vendas', 'Suporte', 'Treinamento', 'Licenciamento'
                    ];
                    log('Categorias padr√£o: ' + categoriasPadrao.join(', '));
                } else {
                    log('‚úÖ Categorias carregadas do localStorage:');
                    const nomesCategoria = categorias.map(cat => cat.nome);
                    log('Dropdown teria as op√ß√µes: ' + nomesCategoria.join(', '));
                }
                
                log('üéØ Teste: Abra o modal de produtos e verifique se as categorias listadas acima aparecem!');
                
            } catch (error) {
                log('‚ùå Erro na simula√ß√£o: ' + error.message, 'error');
            }
        }

        // Inicializa√ß√£o
        log('üöÄ Sistema de teste carregado. Ready para testar categorias!');
        listarCategorias();
    </script>
</body>
</html>
