{
  "nome": "Fluxo PadrÃ£o - Triagem Inteligente v3.0",
  "descricao": "Fluxo otimizado com verificaÃ§Ã£o automÃ¡tica de contato, coleta inteligente de dados e menus dinÃ¢micos",
  "tipo": "arvore_decisao",
  "ativo": true,
  "publicado": false,
  "estrutura": {
    "etapaInicial": "verificar-contato",
    "versao": "3.0",
    "metadata": {
      "autor": "GitHub Copilot + Equipe ConectCRM",
      "dataCriacao": "2025-10-29",
      "features": [
        "VerificaÃ§Ã£o automÃ¡tica de contato",
        "Coleta inteligente de dados",
        "Menus dinÃ¢micos (nÃºcleos e departamentos)",
        "ValidaÃ§Ãµes robustas",
        "Mensagens personalizadas",
        "OpÃ§Ã£o de voltar"
      ]
    },
    "etapas": {
      "verificar-contato": {
        "id": "verificar-contato",
        "tipo": "condicional",
        "mensagem": "ğŸ” Verificando seu cadastro...",
        "condicao": {
          "variavel": "contatoExiste",
          "operador": "igual",
          "valor": true
        },
        "nomeExibicao": "VerificaÃ§Ã£o de Contato",
        "descricao": "Backend busca contato por telefone WhatsApp automaticamente",
        "acaoSeVerdadeiro": "verificar-dados-atualizados",
        "acaoSeFalso": "boas-vindas-novo-cliente",
        "metadata": {
          "automÃ¡tico": true,
          "buscarPor": "telefone_whatsapp"
        }
      },
      "boas-vindas-novo-cliente": {
        "id": "boas-vindas-novo-cliente",
        "tipo": "mensagem",
        "mensagem": "ğŸ‘‹ OlÃ¡! Seja muito bem-vindo(a) ao *ConectCRM*!\n\nVejo que Ã© seu primeiro contato conosco. Que Ã³timo ter vocÃª aqui! ğŸ˜Š\n\nPara melhor atendÃª-lo(a), vou precisar de algumas informaÃ§Ãµes rÃ¡pidas.",
        "nomeExibicao": "Boas-vindas Novo Cliente",
        "proximaEtapa": "coleta-primeiro-nome",
        "metadata": {
          "tom": "caloroso",
          "emoji": true
        }
      },
      "coleta-primeiro-nome": {
        "id": "coleta-primeiro-nome",
        "tipo": "input",
        "mensagem": "ğŸ“ Qual Ã© o seu *primeiro nome*?",
        "variavel": "primeiroNome",
        "validacao": {
          "tipo": "texto",
          "minLength": 2,
          "maxLength": 50,
          "obrigatorio": true,
          "mensagemErro": "Por favor, informe um nome vÃ¡lido (mÃ­nimo 2 caracteres)."
        },
        "coletaDados": true,
        "nomeExibicao": "Coleta Primeiro Nome",
        "proximaEtapa": "coleta-sobrenome",
        "metadata": {
          "dica": "Apenas o primeiro nome, ex: JoÃ£o, Maria"
        }
      },
      "coleta-sobrenome": {
        "id": "coleta-sobrenome",
        "tipo": "input",
        "mensagem": "ğŸ“ E o seu *sobrenome* (Ãºltimo nome)?",
        "variavel": "sobrenome",
        "validacao": {
          "tipo": "texto",
          "minLength": 2,
          "maxLength": 50,
          "obrigatorio": true,
          "mensagemErro": "Por favor, informe seu sobrenome (mÃ­nimo 2 caracteres)."
        },
        "coletaDados": true,
        "nomeExibicao": "Coleta Sobrenome",
        "proximaEtapa": "coleta-empresa",
        "metadata": {
          "dica": "Apenas o Ãºltimo nome, ex: Silva, Santos"
        }
      },
      "coleta-empresa": {
        "id": "coleta-empresa",
        "tipo": "input",
        "mensagem": "ğŸ¢ Qual o nome da *empresa* onde vocÃª trabalha?\n\n_Digite o nome da empresa ou \"NÃ£o trabalho\" se for pessoa fÃ­sica._",
        "variavel": "empresa",
        "validacao": {
          "tipo": "texto",
          "minLength": 2,
          "maxLength": 100,
          "obrigatorio": false,
          "mensagemErro": "Nome da empresa invÃ¡lido."
        },
        "coletaDados": true,
        "nomeExibicao": "Coleta Empresa",
        "proximaEtapa": "coleta-email-novo-cliente",
        "metadata": {
          "opcional": true,
          "exemplo": "Empresa XYZ Ltda"
        }
      },
      "coleta-email-novo-cliente": {
        "id": "coleta-email-novo-cliente",
        "tipo": "input",
        "mensagem": "ğŸ“§ Por Ãºltimo, qual o seu *e-mail*?\n\n_Exemplo: seuemail@empresa.com_",
        "variavel": "email",
        "validacao": {
          "tipo": "email",
          "obrigatorio": true,
          "mensagemErro": "âŒ E-mail invÃ¡lido. Por favor, informe um e-mail vÃ¡lido.\n\nExemplo: nome@empresa.com"
        },
        "coletaDados": true,
        "nomeExibicao": "Coleta E-mail (Novo Cliente)",
        "proximaEtapa": "confirmar-dados-novo-cliente",
        "metadata": {
          "formatoEsperado": "email@dominio.com"
        }
      },
      "confirmar-dados-novo-cliente": {
        "id": "confirmar-dados-novo-cliente",
        "tipo": "menu",
        "mensagem": "âœ… *ConfirmaÃ§Ã£o de Dados*\n\nğŸ“‹ Por favor, confira seus dados:\n\nğŸ‘¤ *Nome:* {{primeiroNome}} {{sobrenome}}\nğŸ¢ *Empresa:* {{empresa}}\nğŸ“§ *E-mail:* {{email}}\nğŸ“± *WhatsApp:* {{telefone}}\n\nâœ”ï¸ Os dados estÃ£o corretos?",
        "opcoes": [
          {
            "id": "confirmar_sim",
            "texto": "âœ… Sim, estÃ£o corretos",
            "valor": "sim",
            "proximaEtapa": "salvar-novo-cliente"
          },
          {
            "id": "confirmar_nao",
            "texto": "âŒ NÃ£o, quero corrigir",
            "valor": "nao",
            "proximaEtapa": "coleta-primeiro-nome"
          }
        ],
        "usarBotoes": true,
        "nomeExibicao": "Confirmar Dados (Novo Cliente)",
        "metadata": {
          "formatacaoEspecial": "confirmacao_dados_novo_cliente",
          "permitirVoltar": true
        }
      },
      "salvar-novo-cliente": {
        "id": "salvar-novo-cliente",
        "tipo": "acao",
        "acao": "salvar_contato",
        "mensagem": "ğŸ’¾ Salvando seus dados...\n\nâœ… Cadastro realizado com sucesso!\n\nAgora vamos te direcionar para o atendimento. ğŸ˜Š",
        "nomeExibicao": "Salvar Novo Cliente",
        "proximaEtapa": "boas-vindas",
        "metadata": {
          "timeout": 2000,
          "criarContato": true,
          "dadosObrigatorios": [
            "primeiroNome",
            "sobrenome",
            "telefone",
            "email"
          ]
        }
      },
      "verificar-dados-atualizados": {
        "id": "verificar-dados-atualizados",
        "tipo": "menu",
        "mensagem": "ğŸ‘‹ OlÃ¡, *{{primeiroNome}}*! Que bom ter vocÃª de volta ao *ConectCRM*! ğŸ˜Š\n\nâœ… *Dados Cadastrados*\n\nğŸ‘¤ *Nome:* {{primeiroNome}} {{sobrenome}}\nğŸ¢ *Empresa:* {{empresa}}\nğŸ“§ *E-mail:* {{email}}\nğŸ”‘ *Cargo:* {{cargo}}\nğŸ“± *Telefone:* {{telefone}}\n\nâœ”ï¸ Os dados estÃ£o corretos?\n\n_Digite o nÃºmero ou clique na opÃ§Ã£o:_",
        "opcoes": [
          {
            "id": "dados_ok",
            "texto": "Sim, estÃ¡ certo",
            "valor": "sim",
            "proximaEtapa": "boas-vindas"
          },
          {
            "id": "dados_desatualizados",
            "texto": "Corrigir dados",
            "valor": "nao",
            "proximaEtapa": "atualizar-dados"
          }
        ],
        "usarBotoes": true,
        "tipoBotao": "reply",
        "nomeExibicao": "Verificar Dados Cadastrados",
        "metadata": {
          "formatacaoEspecial": "confirmacao_dados_existente",
          "maxOpcoes": 2,
          "fallbackWeb": true,
          "aceitarTexto": true,
          "keywords": {
            "sim": "boas-vindas",
            "1": "boas-vindas",
            "certo": "boas-vindas",
            "confirmar": "boas-vindas",
            "ok": "boas-vindas",
            "nao": "atualizar-dados",
            "nÃ£o": "atualizar-dados",
            "2": "atualizar-dados",
            "corrigir": "atualizar-dados",
            "atualizar": "atualizar-dados"
          }
        }
      },
      "atualizar-dados": {
        "id": "atualizar-dados",
        "tipo": "menu",
        "mensagem": "ğŸ”„ *AtualizaÃ§Ã£o de Dados*\n\nQual informaÃ§Ã£o vocÃª deseja atualizar?",
        "opcoes": [
          {
            "id": "atualizar_nome",
            "texto": "ğŸ‘¤ Nome",
            "valor": "nome",
            "proximaEtapa": "coleta-primeiro-nome"
          },
          {
            "id": "atualizar_empresa",
            "texto": "ğŸ¢ Empresa",
            "valor": "empresa",
            "proximaEtapa": "coleta-empresa"
          },
          {
            "id": "atualizar_email",
            "texto": "ğŸ“§ E-mail",
            "valor": "email",
            "proximaEtapa": "coleta-email-atualizado"
          },
          {
            "id": "atualizar_todos",
            "texto": "ğŸ“ Todos os dados",
            "valor": "todos",
            "proximaEtapa": "coleta-primeiro-nome"
          }
        ],
        "usarBotoes": true,
        "nomeExibicao": "Menu Atualizar Dados"
      },
      "coleta-email-atualizado": {
        "id": "coleta-email-atualizado",
        "tipo": "input",
        "mensagem": "ğŸ“§ Informe seu *novo e-mail*:\n\n_Exemplo: seuemail@empresa.com_",
        "variavel": "email",
        "validacao": {
          "tipo": "email",
          "obrigatorio": true,
          "mensagemErro": "âŒ E-mail invÃ¡lido. Tente novamente."
        },
        "coletaDados": true,
        "nomeExibicao": "Atualizar E-mail",
        "proximaEtapa": "salvar-dados-atualizados"
      },
      "salvar-dados-atualizados": {
        "id": "salvar-dados-atualizados",
        "tipo": "acao",
        "acao": "atualizar_contato",
        "mensagem": "ğŸ’¾ Salvando alteraÃ§Ãµes...\n\nâœ… Dados atualizados com sucesso!",
        "nomeExibicao": "Salvar Dados Atualizados",
        "proximaEtapa": "boas-vindas",
        "metadata": {
          "timeout": 2000,
          "atualizarContato": true
        }
      },
      "boas-vindas": {
        "id": "boas-vindas",
        "tipo": "menu",
        "mensagem": "ğŸ¯ Como posso ajudÃ¡-lo(a) hoje, *{{primeiroNome}}*?\n\nSelecione o *setor* que deseja atendimento:",
        "opcoes": [],
        "usarBotoes": true,
        "nomeExibicao": "Menu de NÃºcleos (DinÃ¢mico)",
        "proximaEtapa": "escolha-departamento",
        "metadata": {
          "buscaDinamica": true,
          "fonte": "nucleos",
          "ordenarPor": "nome",
          "filtrarAtivos": true
        }
      },
      "escolha-departamento": {
        "id": "escolha-departamento",
        "tipo": "menu",
        "mensagem": "ğŸ¢ *{{nucleoNome}}*\n\nAgora escolha o *departamento* especÃ­fico:\n\n_ğŸ’¡ Dica: Escolha a Ã¡rea que melhor atende sua necessidade_",
        "opcoes": [],
        "usarBotoes": true,
        "nomeExibicao": "Escolha de Departamento (DinÃ¢mico)",
        "proximaEtapa": "transferir-atendimento",
        "opcoesExtras": [
          {
            "id": "voltar_nucleos",
            "texto": "â¬…ï¸ Voltar aos setores",
            "valor": "voltar",
            "proximaEtapa": "boas-vindas"
          }
        ],
        "metadata": {
          "buscaDinamica": true,
          "fonte": "departamentos",
          "filtrarPorNucleo": true,
          "ordenarPor": "nome",
          "permitirVoltar": true,
          "proximaEtapaDepartamento": "coleta-detalhes-atendimento"
        }
      },
      "coleta-detalhes-atendimento": {
        "id": "coleta-detalhes-atendimento",
        "tipo": "input",
        "mensagem": "ğŸ“ Para agilizar o atendimento em *{{departamentoNome}}*, conte rapidamente como podemos ajudar:",
        "variavel": "resumoAtendimento",
        "validacao": {
          "tipo": "text",
          "minimo": 5,
          "maximo": 500,
          "mensagemErro": "Digite um resumo breve (mÃ­nimo 5 caracteres)."
        },
        "coletaDados": true,
        "nomeExibicao": "Coleta Detalhes Atendimento",
        "proximaEtapa": "confirmar-detalhes-atendimento",
        "metadata": {
          "dica": "Explique em 1 ou 2 frases o motivo do contato"
        }
      },
      "confirmar-detalhes-atendimento": {
        "id": "confirmar-detalhes-atendimento",
        "tipo": "menu",
        "mensagem": "âœ… *Resumo do Atendimento*\n\nğŸ¢ *Departamento:* {{departamentoNome}}\nğŸ—’ï¸ *Resumo:* {{resumoAtendimento}}\n\nAs informaÃ§Ãµes estÃ£o corretas?",
        "opcoes": [
          {
            "id": "detalhes_confirmar",
            "texto": "ï¿½ EstÃ¡ correto",
            "valor": "confirmar",
            "proximaEtapa": "mensagem-pre-transferencia"
          },
          {
            "id": "detalhes_ajustar",
            "texto": "âœï¸ Quero editar o resumo",
            "valor": "ajustar",
            "proximaEtapa": "coleta-detalhes-atendimento"
          },
          {
            "id": "detalhes_voltar",
            "texto": "â¬…ï¸ Escolher outro departamento",
            "valor": "voltar",
            "proximaEtapa": "escolha-departamento"
          }
        ],
        "usarBotoes": true,
        "nomeExibicao": "Confirmar Detalhes Atendimento",
        "metadata": {
          "permitirVoltar": true,
          "keywords": {
            "sim": "mensagem-pre-transferencia",
            "1": "mensagem-pre-transferencia",
            "confirmar": "mensagem-pre-transferencia",
            "ok": "mensagem-pre-transferencia",
            "ajustar": "coleta-detalhes-atendimento",
            "editar": "coleta-detalhes-atendimento",
            "2": "coleta-detalhes-atendimento",
            "voltar": "escolha-departamento",
            "trocar": "escolha-departamento",
            "3": "escolha-departamento"
          }
        }
      },
      "mensagem-pre-transferencia": {
        "id": "mensagem-pre-transferencia",
        "tipo": "mensagem",
        "mensagem": "âœ… Perfeito! Vou repassar seu atendimento para *{{departamentoNome}}* com o resumo informado. \n\nğŸ” Preparando sua transferÃªncia...",
        "aguardarResposta": false,
        "proximaEtapa": "transferir-atendimento",
        "nomeExibicao": "Preparar TransferÃªncia",
        "metadata": {
          "autoAvanco": true
        }
      },
      "transferir-atendimento": {
        "id": "transferir-atendimento",
        "tipo": "acao",
        "acao": "transferir",
        "mensagem": "â³ Encaminhando vocÃª para *{{departamentoNome}}*...\n\nğŸ—’ï¸ *Resumo:* {{resumoAtendimento}}\nğŸ‘¤ Em instantes um de nossos especialistas irÃ¡ atendÃª-lo(a)!\n\n_Aguarde na linha, por favor._",
        "finalizar": true,
        "nomeExibicao": "Transferir para Atendimento",
        "metadata": {
          "prioridade": "normal",
          "distribuicao": "round-robin",
          "salvarHistorico": true,
          "notificarAgente": true,
          "contextoTransferencia": {
            "nome": "{{nomeCompleto}}",
            "empresa": "{{empresa}}",
            "email": "{{email}}",
            "telefone": "{{telefone}}",
            "nucleoEscolhido": "{{nucleoNome}}",
            "departamentoEscolhido": "{{departamentoNome}}",
            "resumo": "{{resumoAtendimento}}"
          }
        }
      },
      "horario-fora-expediente": {
        "id": "horario-fora-expediente",
        "tipo": "mensagem",
        "mensagem": "ğŸ• *HorÃ¡rio de Atendimento*\n\nNo momento estamos *fora do horÃ¡rio de atendimento*.\n\nğŸ“… *HorÃ¡rio de funcionamento:*\nSegunda a Sexta: 08h Ã s 18h\nSÃ¡bado: 08h Ã s 12h\nDomingo: Fechado\n\nğŸ“§ Se preferir, envie um e-mail para:\ncontato@conectcrm.com\n\nRetornaremos assim que possÃ­vel!",
        "finalizar": true,
        "nomeExibicao": "HorÃ¡rio Fora de Expediente",
        "metadata": {
          "opcional": true,
          "usarSeForaHorario": true
        }
      }
    }
  }
}